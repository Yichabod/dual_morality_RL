<html>
    <head>
        <link rel="stylesheet" type="text/css" href="train.css">
        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>
        <script src="gridworld-task.js" type="text/javascript"></script>
        <script>

            let task;
            var data;
            const num_trials = 39

            $(document).ready(() => {   
                $.getJSON("data.json", function(jsondata) {
                    data = jsondata
                    run_trial(data,0)
                });             
            });

            function run_trial(data,num) {
                trial_data = data[num]
                console.log(trial_data)
                task = new GridWorldTask({
                    container: $("#task")[0],
                    step_callback: (d) => {console.log(d)},
                    endtask_callback: () => {
                        if (num + 1 >= num_trials){console.log('absorbing')}
                        else {run_trial(data,num+1)}
                    }
                });
                task.init({
                    init_state: {
                        'agent': trial_data['agent'],
                        'cargo1': trial_data['cargo1'],
                        'cargo2': trial_data['cargo2'],
                        'train': trial_data['train'],
                        'trainvel': trial_data['trainvel']
                    },
                    switch_pos: trial_data['switch'],
                    targets: {
                        'target1': trial_data['target1'],
                        'target2': trial_data['target2']
                    },
                    show_rewards: true,
                    best_reward: trial_data['best_reward']
                });
                task.start();
            }
        </script>
    </head>
    <body>
        <div id="page"> 
            <div id="task"></div>
            <div id="info">
                <div id="reward"> Reward = 0 <br/> Step = 0/5 </div>
                <div id="instructions">Instructions:<br>You are the black dot and can move around the grid using the up, down, left, right, and space keys. The goal of the game is to move cargo (represented by numbered boxes) into their target locations (represented by colored tiles) and keep the train from hitting cargo. You will gain the value of the cargo if it is in the right place at the end of the round (+1 or +2), but lose that value if it is hit by the train (-1 or -2) </div>
            </div>
        </div>
    </body>
</html>